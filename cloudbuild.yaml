steps:
  # Checkout the source code from GitHub
  - name: 'gcr.io/cloud-builders/git'
    args: ['clone', '--branch', 'master', 'https://github.com/Simrankhott/cloudbuild.git', 'new']

  # Build the application using Maven
  - name: 'maven:3-jdk-11'
    entrypoint: 'mvn'
    args: ['clean', 'package']

  # Copy the generated artifact to the new directory
  - name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: 'bash'
    args:
    - '-c'
    - 'cp target/myartifact.jar new/'

  # Generate the artifact named myartifact.jar
  - name: 'gcr.io/cloud-builders/gcloud'
    args:
    - 'builds'
    - 'submit'
    - '--quiet'
    - '--project=${PROJECT_ID}'
    - '--tag=gcr.io/${PROJECT_ID}/myartifact'
    - 'new/Dockerfile'

artifacts:
  objects:
    location: 'gs://${PROJECT_ID}-artifacts'
    paths: ['**/*']
